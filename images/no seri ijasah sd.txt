421.3/178/SMPN.9/2024

421.3/178a/SMPN.9/2024



DN-19/D-SD/K13/

kepsek lama p 7 l 6 = 42   kode = 13.02


AIDIL HAK KK LAMA 7307062003240001

var token="6909777826:AAGMQYa9-GWmwxMSjZkINJe6bC5MCkOLjSo";
var telegramUrl2 = "https://api.telegram.org/bot6909777826:AAGMQYa9-GWmwxMSjZkINJe6bC5MCkOLjSo"
//https://api.telegram.org/bot6909777826:AAGMQYa9-GWmwxMSjZkINJe6bC5MCkOLjSo/getUpdates

var webAppUrl2="https://script.google.com/macros/s/AKfycbzPwyT7AKAemOByxm8v44LPCX_GYU-R-lAWN_4kSs7WimfnDukvvdhWRCDSa2rsDp1J9w/exec"
  
function getMej() {
  var url = telegramUrl2+"/getMe";
  var response = UrlFetchApp.fetch(url);
  Logger.log(response.getContentText());
}

function setWebhook() {
  var url = telegramUrl2 + "/setWebhook?url="+webAppUrl2;
  var response = UrlFetchApp.fetch(url);
  Logger.log(response.getContentText());
}

function getupdatesk() {
  var url = telegramUrl2+'/getUpdates';
  var response = UrlFetchApp.fetch(url);
  Logger.log(response.getContentText());
}


function doPost(e){

 var data = JSON.parse(e.postData.contents);
              
              var text = data.message.text;
              var msgid = data.message.message_id;
              var mid = data.message.from.id;
              var nml=''
              var toh=msgid
 
if ((data.message.document) && (mid == 338724887)){ 
//var  text2=e.postData.contents+'\n'+telegramUrl2 +'\n\n{namafile:"/'+data.message.document.file_name+'",file_id:"'+data.message.document.file_id+'"}';


 
 var namfile=data.message.document.file_name;
 var fileid=data.message.document.file_id;
  

var fileUrl ='https://api.telegram.org/bot'+token+'/getFile?file_id='+fileid;
 
    var response = UrlFetchApp.fetch(fileUrl);
 
 var filePath = JSON.parse(response.getContentText()).result.file_path;
  Logger.log(response) 
 var fileDownloadUrl = 'https://api.telegram.org/file/bot' + token + '/' + filePath;
    var fileBlob = UrlFetchApp.fetch(fileDownloadUrl).getBlob();

    // Save to Google Drive
    var folder = DriveApp.getFolderById('1kHfJiuMlPsaxRjpLRlZynBBXSaBk2w0Y');
    var file = folder.createFile(fileBlob).setName(namfile);
     var fileType = file.getMimeType();
    var fileSizeInBytes = file.getSize();
    var fileSizeInKB = fileSizeInBytes / 1024;
    var uk;
      if (fileSizeInKB>=1024){uk=(fileSizeInKB/1024).toFixed(3)}
      else {uk=fileSizeInKB.toFixed(2)}



sim(mid,namfile,uk,fileType,file.getId())

return}
 

             if ( text.toUpperCase() == "/START" || text.toUpperCase() == "/REFRESH")
                {
                   text=' Silahkan pilih menu berikut :'
                  kirimpesanstr(mid,'OK','')
                   
       

                }
               else {
                perihal(text,mid);
                kirimpesanstr(mid,'Maaf ya','')} 
                
}


 

function sim(mid,nama,uk,tipe,id){
    var tgl2 ="'"+Utilities.formatDate(new Date(), "GMT+08", "dd-MM-yyyy");


 var ss = SpreadsheetApp.openById("117hVlGgB4yiX7d3uyINtk1ZAfi9mMsLKeg6k4b258Kw")
 var sheet = ss.getSheetByName("file");
 var lastRow = sheet.getLastRow()+1;
 sheet.appendRow([tgl2,nama,uk,tipe,id])
 kirimpesanhtml(mid,lastRow+' :'+nama+' Ukuran: '+uk+' KB   '+id+' berhasil disimpan' ,'');
 
}




function perihal(text,mid){

  
  var nn = text
if (nn.includes('=')) {
        var resultSplit = nn.split('=')[0];
        var pp=nn.split('=')[1]
        var ss = SpreadsheetApp.openById("117hVlGgB4yiX7d3uyINtk1ZAfi9mMsLKeg6k4b258Kw")
        var sheet = ss.getSheetByName("file");
        sheet.getRange(resultSplit,6).setValue(pp)
        kirimpesanstr(mid,'Sukses Update :'+pp,'')
         return
    } else {
        
    }

}
